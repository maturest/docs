(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{317:function(e,n,t){"use strict";t.r(n);var _=t(14),a=Object(_.a)({},(function(){var e=this,n=e._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"慢查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#慢查询"}},[e._v("#")]),e._v(" 慢查询")]),e._v(" "),n("blockquote",[n("p",[e._v("慢查询是指那些执行时间超过特定阈值的SQL查询语句。这个阈值是通过MySQL的配置参数long_query_time来设定的，单位是秒。当某个查询的执行时间超过了这个阈值，MySQL就会将这个查询记录到慢查询日志中。")])]),e._v(" "),n("p",[e._v("常规的 "),n("code",[e._v("my.cnf")]),e._v(" 配置内容如下：")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('[client]\n#password\t= your_password\nport\t\t= 3306\nsocket\t\t= /tmp/mysql.sock\n\n[mysqld]\nport\t\t= 3306\nsocket\t\t= /tmp/mysql.sock\ndatadir = /www/server/data\ndefault_storage_engine = InnoDB\nperformance_schema_max_table_instances = 400\ntable_definition_cache = 400\nskip-external-locking\nkey_buffer_size = 128M\nmax_allowed_packet = 100G\ntable_open_cache = 512\nsort_buffer_size = 2M\nnet_buffer_length = 4K\nread_buffer_size = 2M\nread_rnd_buffer_size = 256K\nmyisam_sort_buffer_size = 32M\nthread_cache_size = 64\nquery_cache_size = 64M\ntmp_table_size = 64M\nsql-mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES\n\nexplicit_defaults_for_timestamp = true\n#skip-name-resolve\nmax_connections = 500\nmax_connect_errors = 100\nopen_files_limit = 65535\n\nlog-bin=mysql-bin\nbinlog_format=mixed\nserver-id = 1\nexpire_logs_days = 10\nslow_query_log=1\nslow-query-log-file=/www/server/data/mysql-slow.log\nlong_query_time=3\n#log_queries_not_using_indexes=on\nearly-plugin-load = ""\n\n\ninnodb_data_home_dir = /www/server/data\ninnodb_data_file_path = ibdata1:10M:autoextend\ninnodb_log_group_home_dir = /www/server/data\ninnodb_buffer_pool_size = 512M\ninnodb_log_file_size = 256M\ninnodb_log_buffer_size = 64M\ninnodb_flush_log_at_trx_commit = 1\ninnodb_lock_wait_timeout = 50\ninnodb_max_dirty_pages_pct = 90\ninnodb_read_io_threads = 2\ninnodb_write_io_threads = 2\n\n[mysqldump]\nquick\nmax_allowed_packet = 500M\n\n[mysql]\nno-auto-rehash\n\n[myisamchk]\nkey_buffer_size = 128M\nsort_buffer_size = 2M\nread_buffer = 2M\nwrite_buffer = 2M\n\n[mysqlhotcopy]\ninteractive-timeout\n\n')])])]),n("h3",{attrs:{id:"慢查询日志的作用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#慢查询日志的作用"}},[e._v("#")]),e._v(" 慢查询日志的作用")]),e._v(" "),n("p",[e._v("1、识别出执行时间长的查询语句")]),e._v(" "),n("p",[e._v("2、分析查询语句的执行计划，找出性能瓶颈")]),e._v(" "),n("p",[e._v("3、针对性能瓶颈进行优化，如添加索引，优化查询语句结构等。")]),e._v(" "),n("h3",{attrs:{id:"如何开启慢查询日志"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何开启慢查询日志"}},[e._v("#")]),e._v(" 如何开启慢查询日志")]),e._v(" "),n("h4",{attrs:{id:"临时开启"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#临时开启"}},[e._v("#")]),e._v(" 临时开启")]),e._v(" "),n("p",[e._v("通过 mysql 命令行或者客户端，执行 SQL 命令来开启慢查询日志，并设置相关参数。")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("set global slow_query_log = 'ON';\n\n# 设置阈值为 2 秒\nset global long_query_time = 2;\n\n# 设置慢查询日志文件的路径\nset global slow_query_log_file = '/path/to/your/slow-query.log';\n\n")])])]),n("h4",{attrs:{id:"永久开启"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#永久开启"}},[e._v("#")]),e._v(" 永久开启")]),e._v(" "),n("p",[e._v("修改 mysql 的配置文件 "),n("code",[e._v("/etx/my.cnf")]),e._v("，在"),n("code",[e._v("[mysqld]")]),e._v("部分添加或修改相关配置选项，然后重启mysql服务。")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("[mysqld]\nslow_query_log=1\nslow-query-log-file=/path/to/your/slow-query.log\nlong_query_time=2\n\n")])])])])}),[],!1,null,null,null);n.default=a.exports}}]);