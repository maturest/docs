(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{295:function(a,t,s){"use strict";s.r(t);var e=s(14),r=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"elasticsearch"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch"}},[a._v("#")]),a._v(" Elasticsearch")]),a._v(" "),t("p",[a._v("Elasticsearch 是一个功能强大，易于使用，高度可扩展的分布式全文检索引擎，适用于各种规模和类型的数据搜索和分析需求。")]),a._v(" "),t("h2",{attrs:{id:"环境准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境准备"}},[a._v("#")]),a._v(" 环境准备")]),a._v(" "),t("p",[a._v("在正式安装之前，查阅官方文档了解到，Elasticsearch 的安装与操作系统和JVM有关。"),t("a",{attrs:{href:"https://www.elastic.co/cn/support/matrix/",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://www.elastic.co/cn/support/matrix/"),t("OutboundLink")],1),a._v("，根据操作系统和JVM的版本，我们选择安装合适版本的 Elasticsearch。")]),a._v(" "),t("h3",{attrs:{id:"确认操作系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#确认操作系统"}},[a._v("#")]),a._v(" 确认操作系统")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("# 打印系统信息\nuname -a\n\n# 查看 /etc/os-release 文件\ncat /etc/os-release\n\n")])])]),t("h3",{attrs:{id:"确认-java-版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#确认-java-版本"}},[a._v("#")]),a._v(" 确认 Java 版本")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("# 查看版本\njava -version\n\n# 或者查看 java 命令的位置\nwhich java\n\n# 查找命令的位置\ncommand -v java\n\n")])])]),t("p",[a._v("在大多数 Linux 系统中，/usr/bin/java 是一个指向实际 Java 可执行文件的符号链接。你可以使用 ls 命令的 -l 选项来查看这个链接指向哪里,可以帮助你确定 Java 的安装位置。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("ls -l /usr/bin/java\n")])])]),t("p",[a._v("又或者包管理器来查询已安装的 java 包")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("yum list installed | grep java\n")])])]),t("h3",{attrs:{id:"安装-java"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-java"}},[a._v("#")]),a._v(" 安装 Java")]),a._v(" "),t("p",[a._v("如果没有 java 的话，安装即可")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("# 搜索 java 包\nyum -y list java*\n\n# 安装 java 包\nyum install -y java-1.8.0-openjdk.x86_64\n\n")])])]),t("h3",{attrs:{id:"php-客户端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#php-客户端"}},[a._v("#")]),a._v(" PHP 客户端")]),a._v(" "),t("p",[a._v("Elasticsearch 有很多客户端 "),t("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/client/index.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://www.elastic.co/guide/en/elasticsearch/client/index.html"),t("OutboundLink")],1),a._v("，有 java，javascript，go，rust，python，php等等。由于我们的项目是 PHP 项目，另外项目的 PHP 版本是 7.3，因此确认使用 Elasticsearch 的 7.17 版本。")]),a._v(" "),t("h2",{attrs:{id:"安装-elasticsearch"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-elasticsearch"}},[a._v("#")]),a._v(" 安装 Elasticsearch")]),a._v(" "),t("p",[a._v("经过上面环境准备，确认需要安装的是 7.17 版本，参考官方的文档："),t("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/7.17/getting-started.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://www.elastic.co/guide/en/elasticsearch/reference/7.17/getting-started.html"),t("OutboundLink")],1)]),a._v(" "),t("h3",{attrs:{id:"源码安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#源码安装"}},[a._v("#")]),a._v(" 源码安装")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("# 下载源码压缩包\nwget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.17.18-linux-x86_64.tar.gz\n\n# 解压\ntar -xzf elasticsearch-7.17.18-linux-x86_64.tar.gz\n\n# 进入目录\ncd elasticsearch-7.17.18/\n\n# 做为守护进程启动\n./bin/elasticsearch -d -p pid\n")])])]),t("p",[a._v("启动的过程会报错："),t("code",[a._v("java.lang.RuntimeException: can not run elasticsearch as root")]),a._v("，意思就是不能使用root权限启动。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("# 添加新用户\nuseradd user-es\n\n# 改变目录权限\nchown user-es:user-es -R elasticsearch-7.17.18\n\n# 此处为备注信息，用户密码：useres123456\n")])])]),t("p",[a._v("再次启动服务即可，顺便检查下服务是否正常启动")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('curl -X GET "localhost:9200/?pretty"\n')])])]),t("p",[a._v("出现以下结果：")]),a._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"name"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"iZ8vb1bgiwdylmgiy04tz8Z"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"cluster_name"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"elasticsearch"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"cluster_uuid"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"YcorPi1rQ0iLrZILjLBDEQ"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"version"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"number"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"7.17.18"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"build_flavor"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"default"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"build_type"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"tar"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"build_hash"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"8682172c2130b9a411b1bd5ff37c9792367de6b0"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"build_date"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"2024-02-02T12:04:59.691750271Z"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"build_snapshot"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"lucene_version"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"8.11.1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"minimum_wire_compatibility_version"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"6.8.0"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"minimum_index_compatibility_version"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"6.0.0-beta1"')]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"tagline"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"You Know, for Search"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("h3",{attrs:{id:"服务的启动与关闭"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务的启动与关闭"}},[a._v("#")]),a._v(" 服务的启动与关闭")]),a._v(" "),t("p",[a._v("后台启动服务")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("# 进入目录\ncd /usr/local/src/elasticsearch-7.17.18/bin\n\n# 启动后台服务\n./bin/elasticsearch -d \n\n")])])]),t("p",[a._v("关闭服务：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("# 查找进程\nps -ef|grep elasticsearch\n\n# 杀死进程\nkill -9 pid\n")])])]),t("p",[a._v("至此 Elasticsearch 已经安装完毕，同时也引出了 PHP 客户端，通过 composer 引入项目使用即可。")]),a._v(" "),t("h2",{attrs:{id:"相关配置项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#相关配置项"}},[a._v("#")]),a._v(" 相关配置项")]),a._v(" "),t("h3",{attrs:{id:"内存问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#内存问题"}},[a._v("#")]),a._v(" 内存问题")]),a._v(" "),t("p",[a._v("正常启动 Elasticsearch 服务后，在宝塔首页查看内容使用率，直接飙升至 90% 。这样的话就会影响到线上的其他业务。因此还需要修改一下配置项")]),a._v(" "),t("p",[a._v("修改配置文件 "),t("code",[a._v("/usr/local/src/elasticsearch-7.17.18/config/jvm.options")]),a._v("，"),t("strong",[a._v("注意在修改之前，比较好的实践经验是先备份一下要修改的配置文件")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("# 默认配置\n-Xms4g\n-Xmx4g\n\n# 我们调小一些\n-Xms512m\n-Xmx512m\n\n")])])]),t("h3",{attrs:{id:"修改配置项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改配置项"}},[a._v("#")]),a._v(" 修改配置项")]),a._v(" "),t("p",[a._v("修改配置文件 "),t("code",[a._v("/usr/local/src/elasticsearch-7.17.18/config/elasticsearch.yml")]),a._v("，"),t("strong",[a._v("注意在修改之前，比较好的实践经验是先备份一下要修改的配置文件")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('# 配置集群名字\ncluster.name: yzh-plate\n\n# 配置节点名称\nnode.name: yzh-plate-snapshot\n\n# 修改绑定的ip允许远程访问\nnetwork.host: 0.0.0.0\n\n# 配置端口号\nhttp.port: 9200\n\n# 配置集群主机列表\ndiscovery.seed_hosts: ["127.0.0.1"]\n\n# 启动时初始化的参与选主的node，生产环境必填\ncluster.initial_master_nodes: ["node-1"]\n\n# 允许跨域访问\nhttp.cors.enabled: true\nhttp.cors.allow-origin: "*"\n\n')])])]),t("h3",{attrs:{id:"数据可视化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据可视化"}},[a._v("#")]),a._v(" 数据可视化")]),a._v(" "),t("p",[a._v("需要安装 elasticsearch-head")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("# 拉取项目 或者下载 zip 压缩\ngit clone git@github.com:mobz/elasticsearch-head.git\n\n# 启动项目\nnpm run start &\n\n# 如果提示 9100 端口已被占用,查看端口并杀死该进程，然后再重新启动\nlsof -i:9100\nkill -9 pid\n\n# 后台启动\nnohup npm run start &\n\n# 执行退出操作\nexit\n\n")])])]),t("p",[a._v("注意：如果提示elasticsearch用户拥有的内存权限太小，至少需要262144，解决办法：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("# 切换到root用户\nsu root\n\n# 执行命令\nvim /etc/sysctl.conf\n\n# 添加如下配置\nvm.max_map_count = 262144\n\n# 保存退出之后，应用新的更改\nsysctl -p\n")])])]),t("p",[a._v("访问如下链接：")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("网页的形式查看是否启动成功 "),t("a",{attrs:{href:"http://192.168.56.57:9200/",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://192.168.56.57:9200/"),t("OutboundLink")],1)])]),a._v(" "),t("li",[t("p",[a._v("直观的查看数据形式 "),t("a",{attrs:{href:"http://192.168.56.57:9100/",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://192.168.56.57:9100/"),t("OutboundLink")],1)])])])])}),[],!1,null,null,null);t.default=r.exports}}]);